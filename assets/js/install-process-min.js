const INSTALL_URL="/wp-content/mu-plugins/ovs/install/install.php",SELECTORS={INSTALL_MODAL:".install-modal",INSTALL_WRAPPER:".install-modal .wrapper",LIST_ITEMS:".install-modal .wrapper .list p"};function configChoice(){document.querySelector(SELECTORS.INSTALL_WRAPPER).innerHTML='\n        <div>\n            <h1>Pamramètres & sélections des éléments à mettre en place</h1>\n\t\t\t\t\t\t<form action="" id="form-config">\n\t\t\t\t\t\t\t<div class="theme">\n\t\t\t\t\t\t\t\t<h3>Thème Enfant</h3>\n\t\t\t\t\t\t\t\t<label htmlFor="theme">Indiquer l\'identifiant du thème parent auquel lier le thème enfant. <sup>*</sup></label>\n\t\t\t\t\t\t\t\t<input type="text" id="theme" name=\'theme\' required placeholder="identifiant du theme parent" />\n\t\t\t\t\t\t\t\t<p>L\'identifiant du thème parent correspond au nom du dossier du theme que vous pouvez trouver dans /wp-content/themes. Généralement il est en minuscule et ne comporte pas d\'espace, ni de - ou de _ et pas d\'accents. Exemeple Twenty twenty four = twentytwentyfour</p>\n\t\t\t\t\t\t\t</div>\n              <div class="grid">\n                <div>\n                <h3>Liste des plugins qui vont être installés</h3>\n                <ul>\n                  <li><b>Contact Form 7 :</b> gestionnaire de formulaire</li>\n                  <li><b>Resumh it :</b> optimise et compresse les images</li>\n                  <li><b>WebP Converter :</b> Convertit les .jpg, .jpeg, .png au format .webp pour optimiser le poids des images</li>\n                  <li><b>SEO press :</b> indicateur des bonne pratique SEO et permet une configuration de base pour optimiser le référencement du site.</li>\n                  <li><b>Two factor :</b> Connexion à l\'admin par double authentification.</li>\n                </ul>\n                </div>\n                <div>\n                  <h3>Sélectionnez parmis la liste les fonctionnalités que vous souhaitez mettre en place</h3>\n                  <label htmlFor="comments">\n                    <input type="checkbox" id="comments" name="features[]" value="remove-comments" id="" /> Supprime la possibilité d\'ajouter des commentaires. Si les commentaires ne sont pas utilisés sur le site il est recommandé d\'activer cette fonctionnalité pour gagner en sécurité. \n                  </label>\n                  <label htmlFor="cookie">\n                    <input type="checkbox" name="features[]" value="tarte-au-citron" id="cookie" /> Activer le gestionnaire de cookie Tarte Au Citron.\n                  </label>\n                </div>\n              </div>\n\t\t\t\t\t\t\t<button type="submit" class="submit-config">Installer</button>\n\t\t\t\t\t\t</form>\n        </div>'}async function progressInstall(e){clearInstallWrapper(),progressBar(),await executeActions(e)}function clearInstallWrapper(){const e=document.querySelector(SELECTORS.INSTALL_WRAPPER);for(;e.firstChild;)e.removeChild(e.firstChild)}function progressBar(){document.querySelector(SELECTORS.INSTALL_WRAPPER).innerHTML='\n        <div id="progress-bar">\n            <h1>Installation des éléments de base</h1>\n            <div class="progress-bar">\n                <div id="progress" style="width: 0%;"></div>\n            </div>\n            <div class="list">\n                <p class="theme"><span class="icon-spinner"></span> Theme enfant</p>\n                <p class="security"><span class="icon-spinner"></span> Règles de sécurités</p>\n                <p class="plugins"><span class="icon-spinner"></span> Plugins de base</p>\n                <p class="features"><span class="icon-spinner"></span> Fonctionnalités</p>\n            </div>\n        </div>'}function executeActions(e){const t=["theme","security","plugins","features"],n=100/t.length;let s=0;return Promise.all(t.map((t=>loadFunction(e,t).then((()=>{successLoadFunction(t),s+=n,updateProgress(s)})).catch((e=>{errorLoadFunction(t)})))))}function loadFunction(e,t){var n=new FormData(e.target),s=new URLSearchParams;for(const[e,t]of n.entries())s.append(e,t);return s.append("action","install_ajax"),s.append("function",t),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()}).then((e=>{if(e.ok)return e.json();throw new Error("Échec de la requête AJAX")})).then((e=>{if("success"===e.status)return e;throw new Error(e.message)}))}function updateProgress(e){document.querySelector(".wrapper #progress").style.width=e+"%"}function successLoadFunction(e){document.querySelector(`${SELECTORS.LIST_ITEMS}.${e} span`).classList.replace("icon-spinner","icon-check-circle1")}function errorLoadFunction(e){document.querySelector(`${SELECTORS.LIST_ITEMS}.${e} span`).classList.replace("icon-spinner","icon-close-outline")}function checkInstall(){const e=document.querySelectorAll(SELECTORS.LIST_ITEMS+" .icon-check-circle1"),t=document.querySelectorAll(SELECTORS.LIST_ITEMS).length;if(e.length===t)return removeInstallProcess(),document.querySelector(SELECTORS.INSTALL_MODAL).classList.add("remove"),void setTimeout((()=>{document.querySelector(SELECTORS.INSTALL_MODAL).remove()}),520);throw new Error("Certains éléments n'ont pas été installés.")}async function removeInstallProcess(){return fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"install_ajax",function:"remove"})})}document.querySelector(SELECTORS.INSTALL_MODAL)&&(document.querySelector(SELECTORS.INSTALL_MODAL+" .install").addEventListener("click",configChoice),document.querySelector(SELECTORS.INSTALL_MODAL).addEventListener("submit",(async e=>{if(e.preventDefault(),e.target&&"form-config"===e.target.id)try{await progressInstall(e),checkInstall()}catch(e){}})));